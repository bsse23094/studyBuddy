import{Q as a,a as i,l as n}from"./chunk-JSD32Q4O.js";var u=class o{currentUserSubject=new n(null);currentUser$=this.currentUserSubject.asObservable();progressSubject=new n(null);progress$=this.progressSubject.asObservable();constructor(){this.loadUser(),this.loadProgress()}loadUser(){let e=localStorage.getItem("user_profile");if(e)this.currentUserSubject.next(JSON.parse(e));else{let r={id:this.generateId(),levelPreference:"highschool",topics:[],createdAt:new Date().toISOString(),preferences:{defaultMode:"explain",defaultTopK:5,enableStreaming:!0,enableOfflineMode:!1}};this.setUser(r)}}loadProgress(){let e=localStorage.getItem("user_progress");if(e)this.progressSubject.next(JSON.parse(e));else{let r=this.currentUserSubject.value;if(r){let t={userId:r.id,totalQuestions:0,correctAnswers:0,activeMinutes:0,topicMastery:{},lastActive:new Date().toISOString()};this.setProgress(t)}}}setUser(e){localStorage.setItem("user_profile",JSON.stringify(e)),this.currentUserSubject.next(e)}updateUserPreferences(e){let r=this.currentUserSubject.value;if(r){let t=i(i({},r),e);this.setUser(t)}}setLevel(e){this.updateUserPreferences({levelPreference:e})}addTopic(e){let r=this.currentUserSubject.value;if(r){let t=r.topics||[];t.includes(e)||this.updateUserPreferences({topics:[...t,e]})}}setProgress(e){localStorage.setItem("user_progress",JSON.stringify(e)),this.progressSubject.next(e)}recordQuizResult(e,r){let t=this.progressSubject.value;if(!t)return;t.totalQuestions++,r&&t.correctAnswers++,t.topicMastery[e]||(t.topicMastery[e]={topic:e,questionsAnswered:0,accuracy:0,daysStudied:1,lastStudied:new Date().toISOString(),masteryLevel:"beginner"});let s=t.topicMastery[e];s.questionsAnswered++,s.accuracy=(s.accuracy*(s.questionsAnswered-1)+(r?1:0))/s.questionsAnswered,s.lastStudied=new Date().toISOString(),s.masteryLevel=this.calculateMasteryLevel(s.accuracy,s.questionsAnswered),t.lastActive=new Date().toISOString(),this.setProgress(t)}recordStudyTime(e){let r=this.progressSubject.value;r&&(r.activeMinutes+=e,r.lastActive=new Date().toISOString(),this.setProgress(r))}calculateMasteryLevel(e,r){return r<5?"beginner":e>=.9&&r>=20?"expert":e>=.8&&r>=10?"advanced":e>=.6?"intermediate":"beginner"}generateId(){return`user_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getCurrentUser(){return this.currentUserSubject.value}getProgress(){return this.progressSubject.value}exportData(){let e=this.currentUserSubject.value,r=this.progressSubject.value,t={user:e,progress:r,exportedAt:new Date().toISOString()};return JSON.stringify(t,null,2)}clearData(){localStorage.removeItem("user_profile"),localStorage.removeItem("user_progress"),this.loadUser(),this.loadProgress()}static \u0275fac=function(r){return new(r||o)};static \u0275prov=a({token:o,factory:o.\u0275fac,providedIn:"root"})};export{u as a};
